---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import CategorySection from '../components/CategorySection.astro';
import CartFloatingButton from '../components/CartFloatingButton.astro';
import { getMenuData } from '../lib/googleSheets';

const menuData = await getMenuData();
---

<Layout>
  <Header />

  <!-- Category navigation pills -->
  <nav
    class="theme-nav sticky top-[72px] z-40 py-2.5 overflow-x-auto"
    style="backdrop-filter: blur(12px);"
  >
    <div class="flex gap-2 px-4 w-max min-w-full">
      {menuData.map((cat) => (
        <a
          href={`#${cat.id}`}
          class="flex-shrink-0 px-3.5 py-1.5 rounded-xl text-sm font-black uppercase tracking-wider transition-all duration-200 whitespace-nowrap theme-pill-inactive"
          style="font-family: 'Nunito', sans-serif; border: 2px solid #1A1A1A; box-shadow: 2px 2px 0px #1A1A1A;"
          data-nav-pill={cat.id}
        >
          {cat.emoji} {cat.category.split(' ').slice(1).join(' ')}
        </a>
      ))}
    </div>
  </nav>

  <!-- Hero banner -->
  <div
    class="relative mx-4 mt-4 mb-5 rounded-xl p-5 overflow-hidden"
    style="background: #FFC520; border: 4px solid #1A1A1A; box-shadow: 6px 6px 0px #1A1A1A; min-height: 170px;"
  >
    <!-- Content: izquierda, deja espacio a la papita -->
    <div class="relative z-10 max-w-[58%]">
      <div class="inline-flex items-center gap-2 mb-2 bg-[#1A1A1A] text-[#FDFDFD] px-3 py-1 rounded-full border-2 border-[#1A1A1A] transform -rotate-2">
        <span class="text-xs font-black uppercase tracking-widest" style="font-family: 'Nunito', sans-serif;">ğŸ”¥ MenÃº Digital</span>
      </div>
      <h1 class="text-[2.2rem] font-black leading-none mb-3 mt-2 uppercase tracking-wide" style="color: #1A1A1A; font-family: 'Bangers', cursive; text-shadow: 3px 3px 0px #FDFDFD, -1px -1px 0 #FDFDFD, 1px -1px 0 #FDFDFD, -1px 1px 0 #FDFDFD, 1px 1px 0 #FDFDFD;">
        Â¡Bienvenido a<br/>
        <span style="color: #E52521; text-shadow: 2px 2px 0px #1A1A1A, -1px -1px 0 #1A1A1A, 1px -1px 0 #1A1A1A, -1px 1px 0 #1A1A1A, 1px 1px 0 #1A1A1A;">PAPA CHULA!</span>
      </h1>
      <p class="text-xs font-bold inline-block px-2.5 py-1.5 rounded-lg border-2 border-[#1A1A1A] transform rotate-1" style="color: #1A1A1A; background: #FDFDFD; font-family: 'Nunito', sans-serif; box-shadow: 3px 3px 0px #1A1A1A;">
        ğŸŸ ElegÃ­ y pedÃ­ por WhatsApp ğŸš€
      </p>
    </div>

    <!-- Sticker papita: fondo blanco + multiply = desaparece sobre el amarillo -->
    <img
      src="/img/papita.png"
      alt="Papita con actitud"
      class="absolute -bottom-13 right-0 h-full z-20 transition-transform duration-300 hover:-translate-y-1 hover:rotate-2 select-none pointer-events-none"
      style="max-height: 200px; mix-blend-mode: multiply; filter: drop-shadow(3px 3px 0px rgba(0,0,0,0.4));"
      draggable="false"
    />

    <!-- Decorative pop-art dot (top right) -->
    <div class="absolute -right-4 -top-4 w-20 h-20 rounded-full border-4 border-[#1A1A1A] bg-[#E52521] z-10"></div>
  </div>

  <!-- Menu categories -->
  <main class="pb-32 max-w-4xl mx-auto">
    {menuData.map((category) => (
      <CategorySection
        id={category.id}
        category={category.category}
        emoji={category.emoji}
        products={category.products}
      />
    ))}
  </main>

  <CartFloatingButton />
</Layout>

<script>
  const sections = document.querySelectorAll('section[id]');
  const pills = document.querySelectorAll('[data-nav-pill]');
  const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

  const activeStyle = { bg: '#FFC520', color: '#1A1A1A' };
  const inactiveStyleDark = { bg: '#333333', color: '#AAAAAA' };
  const inactiveStyleLight = { bg: '#E0E0E0', color: '#555555' };

  function setActivePill(id: string) {
    pills.forEach((pill) => {
      const el = pill as HTMLElement;
      const inactive = isDark ? inactiveStyleDark : inactiveStyleLight;
      if (el.dataset.navPill === id) {
        el.style.background = activeStyle.bg;
        el.style.color = activeStyle.color;
      } else {
        el.style.background = inactive.bg;
        el.style.color = inactive.color;
      }
    });
  }

  // Set first pill active by default
  if (pills.length > 0) {
    const firstPill = pills[0] as HTMLElement;
    firstPill.style.background = '#FFC520';
    firstPill.style.color = '#1A1A1A';
  }

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) setActivePill(entry.target.id);
      });
    },
    { rootMargin: '-20% 0px -60% 0px' }
  );

  sections.forEach((section) => observer.observe(section));
</script>
